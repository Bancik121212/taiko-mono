import { Callout, Steps, Tab, Tabs } from "nextra-theme-docs";

# Run a Sepolia node

This guide will help you get a Sepolia archive node up and running.

## Prerequisites

- [Docker](https://docs.docker.com/engine/install/) is installed and **running**.
- [Git](https://github.com/git-guides/install-git/) is installed.
- As of `2023-06-21` a full archive node sync takes **326 GB** with geth + lighthouse. Consult the hardware requirements of the execution + consensus clients you are using.

## Steps

<Steps>
### Clone eth-docker
```sh
git clone https://github.com/eth-educators/eth-docker
cd eth-docker
```

### Enable archive mode

First, copy `default.env` to `.env`:

```
cp default.env .env
```

Next, open the `.env` file in your preferred text editor and set:

```filename=e
ARCHIVE_NODE=true
```

### Expose RPC ports

You need to expose the node's RPC ports so that the Taiko L2 node can make calls to it. eth-docker offers a few options that you can read about [here](https://eth-docker.net/Usage/Advanced#sharing-rpc-and-rest-ports).

An easy option is to append `el-shared.yml` to the list of files set with the `COMPOSE_FILE` variable in the `.env` file. Keep in mind this is **not encrypted**, so you should not expose it to the internet.

For example, your `COMPOSE_FILE` flag in your `.env` file should look something like 
```bash
COMPOSE_FILE=lighthouse-cl-only.yml:geth.yml:el-shared.yml
```

### Complete the eth-docker quickstart

Complete the [eth-docker quickstart](https://eth-docker.net/Usage/QuickStart/). You will need to run the config command:
```sh
./ethd config
```
After setting up the config, start the Execution Layer and Consensus Layer clients with admin permission 
```sh
sudo ./ethd up
```
### Check your connection

Check if the node is connected and synced by requesting the latest Sepolia block from the Execution Layer client (change port from `8545` to whatever you have the execution client p2p port set to in your `.env` file):

```bash
curl -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":0}' http://127.0.0.1:8545
```
If your response block number is less than the current block, check the Execution Layer client logs
```bash
./ethd logs -f execution
```
and wait to sync for the latest block as shown here on [Sepolia's Etherscan Blocks](https://sepolia.etherscan.io/blocks)

<Callout type="warning">
If you get the following error after running the curl command
```bash
curl: (7) failed to connect to localhost port 8545 after 0 ms: connection refused
```
check that your Execution Layer client ports are setup by updating `COMPOSE_FILE` to include `el-shared.yml` as described in step `Expose RPC ports`.
</Callout>

### Harden your network (optional)

This is important especially if you `ssh` into machine or open ports to the internet (be careful about that). Here are some recommended resources:

- https://eth-docker.net/Usage/LinuxSecurity
- https://www.coincashew.com/coins/overview-eth/archived-guides/guide-or-how-to-setup-a-validator-on-eth2-mainnet/part-i-installation/guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node
- https://tailscale.com/kb/1077/secure-server-ubuntu-18-04
- https://danthesalmon.com/ufw-docker-tailscale
- https://github.com/chaifeng/ufw-docker

</Steps>

## Videos

- [Run a Sepolia L1 archive node (YouTube)](https://www.youtube.com/watch?v=7Lg_cY7iP2o)
